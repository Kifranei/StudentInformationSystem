@model StudentInformationSystem.Models.ClassSessions

@{
    ViewBag.Title = "删除课程安排";
}

<h2>删除课程安排</h2>
<hr />

<div class="alert alert-danger">
    <h4><span class="glyphicon glyphicon-warning-sign"></span> 确认删除</h4>
    <p>您确定要删除以下课程安排吗？此操作无法撤销，且会影响相关教师和学生的课表。</p>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">课程安排详情</h3>
    </div>
    <div class="panel-body">
        <dl class="dl-horizontal">
            <dt>课程名称：</dt>
            <dd><strong>@Model.Courses.CourseName</strong></dd>

            <dt>任课教师：</dt>
            <dd>
                @if (Model.Courses.Teachers != null)
                {
                    @Model.Courses.Teachers.TeacherName
                }
                else
                {
                    <span class="text-muted">未分配教师</span>
                }
            </dd>

            <dt>课程类型：</dt>
            <dd>
                @{
                    string courseType = "";
                    switch (Model.Courses.CourseType)
                    {
                        case 1: courseType = "专业必修"; break;
                        case 2: courseType = "公共必修"; break;
                        case 3: courseType = "专业选修"; break;
                        case 4: courseType = "公共选修"; break;
                        case 5: courseType = "体育选修"; break;
                        default: courseType = "未知类型"; break;
                    }
                }
                <span class="label label-info">@courseType</span>
            </dd>

            <dt>周次范围：</dt>
            <dd>第 @Model.StartWeek - @Model.EndWeek 周</dd>

            <dt>上课时间：</dt>
            <dd>
                @{
                    string[] dayNames = { "", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日" };
                    var dayName = Model.DayOfWeek >= 1 && Model.DayOfWeek <= 7 ? dayNames[Model.DayOfWeek] : "未知";
                }
                @dayName 第 @Model.StartPeriod - @Model.EndPeriod 节
                <br />
                <small class="text-muted">
                    @{
                        string[] periodTimes = { "08:40-09:25", "09:30-10:15", "10:35-11:20", "11:25-12:10", "13:20-14:05", "14:10-14:55", "15:15-16:00", "16:05-16:50", "17:30-18:15", "18:20-19:05", "19:10-19:55", "20:00-20:45" };
                        var startTime = Model.StartPeriod >= 1 && Model.StartPeriod <= 12 ? periodTimes[Model.StartPeriod - 1].Split('-')[0] : "";
                        var endTime = Model.EndPeriod >= 1 && Model.EndPeriod <= 12 ? periodTimes[Model.EndPeriod - 1].Split('-')[1] : "";
                    }
                    (@startTime - @endTime)
                </small>
            </dd>

            <dt>教室：</dt>
            <dd>@Model.Classroom</dd>

            <dt>假日状态：</dt>
            <dd>
                @{
                    var holidayWeeks = StudentInformationSystem.Helpers.HolidayHelper.GetCurrentSemesterHolidayWeeks();
                    var conflictingHolidayWeeks = new List<int>();
                    for (int week = Model.StartWeek; week <= Model.EndWeek; week++)
                    {
                        if (holidayWeeks.Contains(week))
                        {
                            conflictingHolidayWeeks.Add(week);
                        }
                    }
                }
                @if (conflictingHolidayWeeks.Any())
                {
                    <span class="label label-warning">包含假日周次</span>
                    <br />
                    <small class="text-muted">第@(string.Join("、", conflictingHolidayWeeks))周为法定假日，课程不会在这些周次显示</small>
                }
                else
                {
                    <span class="label label-success">无假日冲突</span>
                    <br />
                    <small class="text-muted">所有周次均为正常上课周</small>
                }
            </dd>
        </dl>
    </div>
</div>

@using (Html.BeginForm()) {
    @Html.AntiForgeryToken()

    <div class="form-actions">
        <input type="submit" value="确认删除" class="btn btn-danger" onclick="return confirm('您确定要删除这个课程安排吗？此操作无法撤销，且会影响相关教师和学生的课表！');" />
        @Html.ActionLink("取消", "CourseSchedule", new { courseId = Model.CourseID }, new { @class = "btn btn-default" })
    </div>
}

<div class="panel panel-info" style="margin-top: 30px;">
    <div class="panel-heading">
        <h4><span class="glyphicon glyphicon-info-sign"></span> 管理员删除说明</h4>
    </div>
    <div class="panel-body">
        <ul>
            <li><strong>管理员权限：</strong>您拥有删除所有课程安排的权限。</li>
            <li><strong>影响范围：</strong>删除此课程安排后，它将从所有相关的课表中移除。</li>
            <li><strong>教师影响：</strong>该安排会从任课教师的课表中消失。</li>
            <li><strong>学生影响：</strong>选修该课程的学生课表也会受到影响。</li>
            <li><strong>不可撤销：</strong>删除操作无法撤销，如需恢复，需要重新创建。</li>
            <li><strong>替代方案：</strong>如果只是想调整时间，建议使用"编辑"功能而不是删除。</li>
        </ul>
        <div class="alert alert-warning" style="margin-top: 15px;">
            <strong>重要提醒：</strong>作为管理员，您的此次操作会影响整个教学系统的排课安排。请谨慎操作。
        </div>
    </div>
</div>

<style>
    .dl-horizontal dt {
        text-align: left;
        width: 100px;
    }
    
    .dl-horizontal dd {
        margin-left: 120px;
    }
    
    .form-actions {
        padding-top: 20px;
        border-top: 1px solid #e5e5e5;
    }
    
    .panel-info {
        border-color: #bee5eb;
    }
    
    .panel-info .panel-heading {
        background-color: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
    }

    .label {
        font-size: 85%;
        padding: 0.3em 0.6em;
    }

    .label-warning {
        background-color: #f0ad4e;
    }

    .label-success {
        background-color: #5cb85c;
    }
</style>